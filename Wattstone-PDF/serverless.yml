service: wattstone-report-api
frameworkVersion: "3"

provider:
  name: aws
  runtime: nodejs20.x
  architecture: arm64
  region: eu-central-1
  stage: dev
  memorySize: 1024
  timeout: 25                 # HTTP API darf max. 30s – daher 25s
  logRetentionInDays: 14
  environment:
    STAGE: ${sls:stage}
    BREVO_DISABLED: "true"    # Dev-Default; echte Werte kommen aus SSM
    MAIL_DELIVERY_MODE: "attachment"

  # WICHTIG: klassische, stabile Syntax benutzen
  iamRoleStatements:
    - Effect: Allow
      Action:
        - ssm:GetParameter
        - ssm:GetParameters
      Resource: "*"           # später gerne einschränken

package:
  patterns:
    - '**/*'
    - '!node_modules/.bin/**'
    - '!**/*.map'
    - '!tests/**'
    - '!.git/**'
    - '!.serverless/**'
    - '!src/**'
    - '!package.json'
    - health.cjs
    - reports.cjs
    - ssm.cjs
    - render.cjs
    - mail.cjs
    - calc.cjs
    - data.cjs
    # optional: doppelte/alte Daten hart ausschließen
    - '!data copy.cjs'
    - '!data.universal.js'



functions:
  health:
    handler: health.handler
    timeout: 10
    events:
      - httpApi:
          path: /health
          method: get

  reports:
    handler: reports.handler
    timeout: 25
    events:
      - httpApi:
          path: /reports
          method: post
